<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Memetic approach to slowing CONCORDE: agent.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_833e22f9acf5a56350012b4685e6385c.html">memetic</a></div>
<h1>agent.c</h1><a href="agent_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include "../ls/ls.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "../util/upper_bound.h"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "../mt19937ar/t_mt19937ar.h"</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="agent_8c.html#90b6273c1a16e912c14900d508377fcc">00019</a> mt_prng <a class="code" href="agent_8c.html#90b6273c1a16e912c14900d508377fcc">pert_rng</a>;
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">00021</a> <span class="keywordtype">char</span> **<a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>;
<a name="l00022"></a><a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">00022</a> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a>;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="agent_8c.html#d5131de0b5004c64db5e79e8aac7471e">00026</a> <span class="preprocessor">#define LINE_LENGTH   160    </span><span class="comment">/* The maximum length of a line in an L-System file.            */</span>
<a name="l00027"></a><a class="code" href="agent_8c.html#56b6dd5d5c43c5f3cf0401897554168b">00027</a> <span class="preprocessor">#define NUM_TSP_ITER   15    </span><span class="comment">/* The number of times to run Concorde on an instance.          */</span>
<a name="l00028"></a><a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">00028</a> <span class="preprocessor">#define NUM_F_CHANGED   3    </span><span class="comment">/* The number of 'F's to pertube at any one time.               */</span>
<a name="l00029"></a><a class="code" href="agent_8c.html#2d87b48d81b5fe21fdc05d03c6b29c14">00029</a> <span class="preprocessor">#define NUM_RAND_INST  10    </span><span class="comment">/* The number of random instances to generate (when pertubing). */</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00042"></a><a class="code" href="agent_8c.html#2420b7fd29fda2a6bda21cfe7fc995ac">00042</a> <span class="keywordtype">void</span> <a class="code" href="agent_8c.html#2420b7fd29fda2a6bda21cfe7fc995ac" title="Creates one TSPlib file generated by an L-System located in the specified file.">createTSPFile</a>(<span class="keywordtype">char</span> *in_fname, <span class="keywordtype">char</span> *lsname, <span class="keywordtype">char</span> *out_fname, <span class="keywordtype">int</span> order)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     <span class="comment">/* Compute the x-y coordinates of the instance represented by this L-System. */</span>
<a name="l00045"></a>00045     <span class="keywordtype">int</span> <a class="code" href="tspsol2mp_8c.html#88002fc5d94ea447f3bb6d6d20141fe2">numnodes</a> = Lsystem(order, in_fname, lsname, <span class="stringliteral">"plots"</span>);
<a name="l00046"></a>00046     printf(<span class="stringliteral">"\nInstance Size: %d\n"</span>, numnodes);fflush(stdout);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048     <span class="comment">/* Now create a valid TSPlib file. */</span>
<a name="l00049"></a>00049     FILE *outfile_stream = fopen(out_fname, <span class="stringliteral">"w"</span>);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051     <span class="comment">/* Check that the file has sucessfully been opened */</span>
<a name="l00052"></a>00052     <span class="keywordflow">if</span> (outfile_stream == NULL)
<a name="l00053"></a>00053     {
<a name="l00054"></a>00054         printf(<span class="stringliteral">"ERROR: File '%s' could not be opened\n"</span>, out_fname);
<a name="l00055"></a>00055         <span class="keywordflow">return</span>;
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <span class="comment">/* Build the header file */</span>
<a name="l00059"></a>00059     fprintf(outfile_stream, <span class="stringliteral">"NAME: %s\n"</span>, lsname);
<a name="l00060"></a>00060     fprintf(outfile_stream, <span class="stringliteral">"TYPE: TSP\n"</span>);
<a name="l00061"></a>00061     fprintf(outfile_stream, <span class="stringliteral">"COMMENT: Created by Farhan Ahammed (farhan.ahammed@studentmail.newcastle.edu.au)\n"</span>);
<a name="l00062"></a>00062     fprintf(outfile_stream, <span class="stringliteral">"DIMENSION: %d\n"</span>, numnodes);
<a name="l00063"></a>00063     fprintf(outfile_stream, <span class="stringliteral">"EDGE_WEIGHT_TYPE: EUC_2D\n"</span>);
<a name="l00064"></a>00064     fprintf(outfile_stream, <span class="stringliteral">"NODE_COORD_TYPE: TWOD_COORDS\n"</span>);
<a name="l00065"></a>00065     fprintf(outfile_stream, <span class="stringliteral">"NODE_COORD_SECTION:\n"</span>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="comment">/* Add the coordinates of the points in this instance. */</span>
<a name="l00068"></a>00068     FILE *nodefile = fopen(<span class="stringliteral">"plots"</span>, <span class="stringliteral">"r"</span>);
<a name="l00069"></a>00069     <span class="keywordtype">char</span> line[255];
<a name="l00070"></a>00070     <span class="keywordflow">while</span>(fgets(line, 255, nodefile) != NULL)
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072         fprintf(outfile_stream, <span class="stringliteral">"%s"</span>, line);
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074     <span class="keyword">remove</span>(<span class="stringliteral">"plots"</span>);
<a name="l00075"></a>00075     fclose(nodefile);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     fprintf(outfile_stream, <span class="stringliteral">"EOF:\n"</span>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="comment">/* Close the file */</span>
<a name="l00080"></a>00080     <span class="keywordtype">int</span> close_error_plot = fclose(outfile_stream);
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (close_error_plot)
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083         printf(<span class="stringliteral">"ERROR: File '%s' could not be closed\n"</span>, out_fname);
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00098"></a><a class="code" href="agent_8c.html#7b90c3cf7f0961309c956c495b7c1017">00098</a> <span class="keywordtype">void</span> <a class="code" href="agent_8c.html#7b90c3cf7f0961309c956c495b7c1017" title="Creates a random perturbation and stores it in the given ruleobj array.">random_perturbation</a>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a> *p)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <span class="keywordtype">int</span> theta, phi;
<a name="l00101"></a>00101     <span class="keywordtype">double</span> a, e;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     a = genrand_real2(&amp;<a class="code" href="agent_8c.html#90b6273c1a16e912c14900d508377fcc">pert_rng</a>);
<a name="l00104"></a>00104     theta = (int)(a*360);
<a name="l00105"></a>00105     phi = 180 - theta;
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (phi &lt; 0) phi = 360 + phi;
<a name="l00107"></a>00107     e = genrand_real3(&amp;<a class="code" href="agent_8c.html#90b6273c1a16e912c14900d508377fcc">pert_rng</a>);
<a name="l00108"></a>00108     <span class="comment">/* Make sure the epsilon doesn't get rounded down to 0.00 or up to 1.00 */</span>
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (e &lt; 0.005) e = 0.01;
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (e &gt; 0.994) e = 0.99;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     sprintf(p[1].str, <span class="stringliteral">"@%0.2f"</span>,  e);
<a name="l00113"></a>00113     sprintf(p[2].str, <span class="stringliteral">"\\%03d"</span>,  theta);
<a name="l00114"></a>00114     sprintf(p[6].str, <span class="stringliteral">"\\%03d"</span>,  phi);
<a name="l00115"></a>00115     sprintf(p[7].str, <span class="stringliteral">"@I%0.2f"</span>, e);
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00122"></a><a class="code" href="structfpos__struct.html#1d37af585e7a115fbf7379b01a4e9538">00122</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{ <span class="keywordtype">int</span> ruleNo, pos; } <a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00135"></a><a class="code" href="agent_8c.html#5a44f4d36905ceb217f41e4754c09fb6">00135</a> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#5a44f4d36905ceb217f41e4754c09fb6" title="Finds where each 'F' is located and returns an array of fpos_struct containing the...">getListOfFs</a>(<a class="code" href="structlsystem.html" title="An L-System.">lsystem</a> *ls, <a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a> **fposArray)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137     <a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a> *array;
<a name="l00138"></a>00138     <span class="keywordtype">int</span> i, j, k, n = 0;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="comment">/* Keep a list of where all the 'F's are (ignoring the axiom). */</span>
<a name="l00141"></a>00141     <span class="keywordflow">for</span> (i = 1; i &lt; ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>; i++)
<a name="l00142"></a>00142         <span class="keywordflow">for</span> (j = 0; j &lt; ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[i]; j++)
<a name="l00143"></a>00143             <span class="keywordflow">if</span> (ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[i][j].<a class="code" href="structruleobj.html#311448896763f241311bec12577c6ce9">type</a> == <a class="code" href="ls_8h.html#42257a545daf5b7933d6e8f96adc74f2">F</a>) n++;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     array = (<a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a>)*n);
<a name="l00146"></a>00146     k = 0;
<a name="l00147"></a>00147     <span class="keywordflow">for</span> (i = 1; i &lt; ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>; i++)
<a name="l00148"></a>00148     {
<a name="l00149"></a>00149         <span class="keywordflow">for</span> (j = 0; j &lt; ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[i]; j++)
<a name="l00150"></a>00150         {
<a name="l00151"></a>00151             <span class="keywordflow">if</span> (ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[i][j].<a class="code" href="structruleobj.html#311448896763f241311bec12577c6ce9">type</a> == <a class="code" href="ls_8h.html#42257a545daf5b7933d6e8f96adc74f2">F</a>)
<a name="l00152"></a>00152             {
<a name="l00153"></a>00153                 array[k].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> = j;
<a name="l00154"></a>00154                 array[k].<a class="code" href="structfpos__struct.html#1d37af585e7a115fbf7379b01a4e9538">ruleNo</a> = i;
<a name="l00155"></a>00155                 k++;
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     *fposArray = array;
<a name="l00160"></a>00160     <span class="keywordflow">return</span> n;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00195"></a><a class="code" href="agent_8c.html#bbbdf5ef052c9228d902881d4c636f55">00195</a> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#bbbdf5ef052c9228d902881d4c636f55" title="Changes the given int array to contain the next combination of numbers. No number...">nextCombination</a>(<span class="keywordtype">int</span> *positions, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> numFs, <span class="keywordtype">int</span> reset)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="keywordtype">int</span> i, j;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (reset)
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201         <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)
<a name="l00202"></a>00202             positions[i] = i;
<a name="l00203"></a>00203         <span class="keywordflow">return</span> 1;
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="comment">/* Check if there are anymore combinations left. */</span>
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (positions[0] == numFs - size)
<a name="l00208"></a>00208         <span class="keywordflow">return</span> 0;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     i = size - 1;
<a name="l00211"></a>00211     <span class="keywordflow">while</span> (positions[i] == numFs - size + i)
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213         i--;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215     positions[i]++;
<a name="l00216"></a>00216     <span class="keywordflow">for</span> (j = i + 1; j &lt; size; j++)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218         positions[j] = positions[i] + j - i;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">return</span> 1;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00236"></a><a class="code" href="agent_8c.html#a59f58090b19e12a78f40fa451b7142f">00236</a> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a59f58090b19e12a78f40fa451b7142f" title="Returns the number of 'F's that will be replaced in the specified rule.">numInsertions</a>(<span class="keywordtype">int</span> *positions, <span class="keywordtype">int</span> size, <a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a> *fposArray, <span class="keywordtype">int</span> ruleNum)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     <span class="keywordtype">int</span> i, count = 0;
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (fposArray[positions[i]].ruleNo == ruleNum)
<a name="l00242"></a>00242             count++;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244     <span class="keywordflow">return</span> count;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00255"></a><a class="code" href="agent_8c.html#5376e996fa9d5f02bcf04e7c41af0162">00255</a> <span class="keywordtype">void</span> <a class="code" href="agent_8c.html#5376e996fa9d5f02bcf04e7c41af0162" title="Creates different perturbations of an L-System in the given lsystem array. and tries...">run</a>(<a class="code" href="structlsystem.html" title="An L-System.">lsystem</a> **pop, <span class="keywordtype">int</span> size)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <span class="keywordtype">int</span> *instancesize, index = 0, i, j;
<a name="l00258"></a>00258     <span class="keywordtype">char</span> text[4];
<a name="l00259"></a>00259     <span class="keywordtype">char</span> *fname, lsname[50], *cmd;
<a name="l00260"></a>00260     <span class="keywordtype">double</span> temp_fit1, temp_fit2, origlowbound[<a class="code" href="ls_8h.html#dffd2a59e153a280e8cf8d963b4622bd" title="The number of orders of the L-System we will create and test.">NUM_ORDER_TEST</a>];
<a name="l00261"></a>00261     <span class="keywordtype">double</span> rt, bb;
<a name="l00262"></a>00262     FILE *fp;
<a name="l00263"></a>00263     <a class="code" href="structlsystem.html" title="An L-System.">lsystem</a> *ls;
<a name="l00264"></a>00264     <a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a> pertarray[] =
<a name="l00265"></a>00265     {
<a name="l00266"></a>00266         {<span class="stringliteral">"G"</span>,     1, <a class="code" href="ls_8h.html#ed9ea78689ecce0b7264c02c7f8a9a54">G</a>},    {<span class="stringliteral">"@0.00"</span>, 5, <a class="code" href="ls_8h.html#0cbea62f1ce2043dd08108e65ed8de1d">SCALE</a>}, {<span class="stringliteral">"\\000"</span>, 4, <a class="code" href="ls_8h.html#9e7f349969ece6e0a2c68f20b9ba2daa">INCX</a>}, {<span class="stringliteral">"F"</span>,      1, <a class="code" href="ls_8h.html#42257a545daf5b7933d6e8f96adc74f2">F</a>},
<a name="l00267"></a>00267         {<span class="stringliteral">"\\180"</span>, 4, <a class="code" href="ls_8h.html#9e7f349969ece6e0a2c68f20b9ba2daa">INCX</a>}, {<span class="stringliteral">"G"</span>,     1, <a class="code" href="ls_8h.html#ed9ea78689ecce0b7264c02c7f8a9a54">G</a>},     {<span class="stringliteral">"\\000"</span>, 4, <a class="code" href="ls_8h.html#9e7f349969ece6e0a2c68f20b9ba2daa">INCX</a>}, {<span class="stringliteral">"@I0.00"</span>, 6, <a class="code" href="ls_8h.html#0cbea62f1ce2043dd08108e65ed8de1d">SCALE</a>}
<a name="l00268"></a>00268     };
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <span class="comment">/* The number of 'F's we'll modify at a time. */</span>
<a name="l00271"></a>00271     <span class="keywordtype">int</span> numFs;
<a name="l00272"></a>00272     <a class="code" href="structfpos__struct.html" title="A structure to store the location of an 'F'.">fpos_struct</a> *fposArray;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (<a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a> == 0)
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276         printf(<span class="stringliteral">"\nThere are no L-Systems (in the specified file) to analyse!"</span>);
<a name="l00277"></a>00277         <span class="keywordflow">return</span>;
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a> &gt; 1)
<a name="l00280"></a>00280     {
<a name="l00281"></a>00281         printf(<span class="stringliteral">"There are more than one L-System in the file.\n"</span>);
<a name="l00282"></a>00282         printf(<span class="stringliteral">"Which one do you want to analyse?\n"</span>);
<a name="l00283"></a>00283         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a>; i++)
<a name="l00284"></a>00284             printf(<span class="stringliteral">"%d. %s\n"</span>, i+1, <a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>[i]);
<a name="l00285"></a>00285         fflush(stdout);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         <span class="keywordflow">if</span> (fgets(text, 4, stdin) != NULL )
<a name="l00288"></a>00288         {
<a name="l00289"></a>00289             <span class="keywordtype">char</span> *newline = strchr(text, <span class="charliteral">'\n'</span>); <span class="comment">/* search for newline character */</span>
<a name="l00290"></a>00290             <span class="keywordflow">if</span> (newline != NULL)
<a name="l00291"></a>00291             {
<a name="l00292"></a>00292                 *newline = <span class="charliteral">'\0'</span>; <span class="comment">/* overwrite trailing newline */</span>
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294             index = (int)strtol(text, NULL, 10) - 1;
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="keywordflow">if</span> (index &gt;= <a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a>) index = 0;
<a name="l00299"></a>00299     ls = pop[index];
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="comment">/* Create a list of where all the 'F's are located so that we can generate</span>
<a name="l00302"></a>00302 <span class="comment">       every possible combination (nCr) of 'F'. */</span>
<a name="l00303"></a>00303     numFs = <a class="code" href="agent_8c.html#5a44f4d36905ceb217f41e4754c09fb6" title="Finds where each 'F' is located and returns an array of fpos_struct containing the...">getListOfFs</a>(ls, &amp;fposArray);
<a name="l00304"></a>00304     <span class="keywordtype">int</span> combArray[<a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>];
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     fp = fopen(<span class="stringliteral">"results.dat"</span>, <span class="stringliteral">"w"</span>);
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (!fp)
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309         printf(<span class="stringliteral">"ERROR: Couldn't open file 'results.dat'\n"</span>);
<a name="l00310"></a>00310         <span class="keywordflow">return</span>;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     fprintf(fp, <span class="stringliteral">"L-System: %s\n=======================================\n\n"</span>, <a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>[index]);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="comment">/* Run the base case (no pertubation). */</span>
<a name="l00316"></a>00316     temp_fit1 = <a class="code" href="ls_8c.html#e387194071046d727dbdf72913716d3a" title="Computes the fitness of the specified L-System.">fitness</a>(ls);
<a name="l00317"></a>00317     fprintf(fp, <span class="stringliteral">"Orig\t\t\t"</span>);
<a name="l00318"></a>00318     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ls_8h.html#dffd2a59e153a280e8cf8d963b4622bd" title="The number of orders of the L-System we will create and test.">NUM_ORDER_TEST</a>; i++)
<a name="l00319"></a>00319     {
<a name="l00320"></a>00320         fprintf(fp, <span class="stringliteral">"[(%9.4f)(%9.4f)(%9.4f)]   "</span>, ls-&gt;<a class="code" href="structlsystem.html#a87a95a800f01c680a271412619649ec" title="The average time it takes for CONCORDE to solve instances created by this L-System...">runningtimes</a>[i], ls-&gt;<a class="code" href="structlsystem.html#2e8aadf5b7a62e0b3d7a0502b4832b59" title="The standard deviation of the set of running times.">sd</a>[i], ls-&gt;<a class="code" href="structlsystem.html#b3dd43d8588ba98ef510fa9e42051caf" title="The number of branch-and-bound nodes needed by CONCORDE to solve instances created...">avgbbnodes</a>[i]);
<a name="l00321"></a>00321         <span class="comment">/* Remember the original running times because we want an L-System that can do better than them. */</span>
<a name="l00322"></a>00322         origlowbound[i] = ls-&gt;<a class="code" href="structlsystem.html#a87a95a800f01c680a271412619649ec" title="The average time it takes for CONCORDE to solve instances created by this L-System...">runningtimes</a>[i] - 2*ls-&gt;<a class="code" href="structlsystem.html#2e8aadf5b7a62e0b3d7a0502b4832b59" title="The standard deviation of the set of running times.">sd</a>[i];
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324     fprintf(fp, <span class="stringliteral">"%9.4f\n\n"</span>, temp_fit1);
<a name="l00325"></a>00325     fflush(fp);
<a name="l00326"></a>00326     fflush(stdout);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">/* oldrule[] will store the old rules so that they can be reset after</span>
<a name="l00330"></a>00330 <span class="comment">       we finish using the modified versions. */</span>
<a name="l00331"></a>00331     <a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a> *oldrule[ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>];
<a name="l00332"></a>00332     <span class="keywordtype">int</span> oldrulelen[ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>];
<a name="l00333"></a>00333     <span class="keywordflow">for</span> (i = 0; i &lt; ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>; i++)
<a name="l00334"></a>00334     {
<a name="l00335"></a>00335         oldrule[i] = NULL;
<a name="l00336"></a>00336         oldrulelen[i] = 0;
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordtype">int</span> rulepos = 1, numIns, count, curr_size, curr_len;
<a name="l00341"></a>00341     <a class="code" href="agent_8c.html#bbbdf5ef052c9228d902881d4c636f55" title="Changes the given int array to contain the next combination of numbers. No number...">nextCombination</a>(combArray, <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>, numFs, 1);
<a name="l00342"></a>00342     <span class="keywordflow">do</span>
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344         temp_fit2 = 0.0;
<a name="l00345"></a>00345         count = 0;
<a name="l00346"></a>00346         <span class="keywordflow">for</span> (i = 1; i &lt;= <a class="code" href="agent_8c.html#2d87b48d81b5fe21fdc05d03c6b29c14">NUM_RAND_INST</a>; i++)
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348             <a class="code" href="ls_8c.html#01c4d678f0b201466286577458a2ffcd" title="Prints a formatted output of the specified L-System.">print_ls</a>(ls);
<a name="l00349"></a>00349             <span class="comment">/* Go through each of the chosen 'F's */</span>
<a name="l00350"></a>00350             j = 0;
<a name="l00351"></a>00351             <span class="keywordflow">while</span> (j &lt; <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>)
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353                 rulepos = fposArray[combArray[j]].ruleNo;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355                 <span class="comment">/* Count the number of 'F's in the current rule that will be replaced. */</span>
<a name="l00356"></a>00356                 numIns = <a class="code" href="agent_8c.html#a59f58090b19e12a78f40fa451b7142f" title="Returns the number of 'F's that will be replaced in the specified rule.">numInsertions</a>(combArray, <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>, fposArray, rulepos);
<a name="l00357"></a>00357                 <span class="keywordflow">if</span> (numIns &gt; 0)
<a name="l00358"></a>00358                 {
<a name="l00359"></a>00359                     <span class="comment">/* Keep a reference to the old rule so that we can reset the rule later on. */</span>
<a name="l00360"></a>00360                     <span class="keywordflow">if</span> (oldrule[rulepos] == NULL)
<a name="l00361"></a>00361                     {
<a name="l00362"></a>00362                         oldrule[rulepos] = ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos];
<a name="l00363"></a>00363                         oldrulelen[rulepos] = ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[rulepos];
<a name="l00364"></a>00364                         ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos] = (<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a> *)malloc((ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[rulepos] + 7*numIns)*<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>));
<a name="l00365"></a>00365                         ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[rulepos] += 7*numIns;
<a name="l00366"></a>00366                     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                     <span class="comment">/* Replace each 'F' in the current rule. Starting with the first. */</span>
<a name="l00370"></a>00370                     <span class="comment">/* Copy the grammar before the 'F'. */</span>
<a name="l00371"></a>00371                     curr_len = fposArray[combArray[j]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a>*<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00372"></a>00372                     memcpy(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos], oldrule[rulepos], curr_len);
<a name="l00373"></a>00373                     curr_size = curr_len/<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375                     <span class="comment">/* Insert the perturbation. */</span>
<a name="l00376"></a>00376                     <a class="code" href="agent_8c.html#7b90c3cf7f0961309c956c495b7c1017" title="Creates a random perturbation and stores it in the given ruleobj array.">random_perturbation</a>(pertarray);
<a name="l00377"></a>00377                     curr_len = 8*<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00378"></a>00378                     memcpy(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos] + curr_size, pertarray, curr_len);
<a name="l00379"></a>00379                     curr_size += curr_len/<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381                     j++;
<a name="l00382"></a>00382                     <span class="keywordflow">while</span> ((j &lt; <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>) &amp;&amp; (fposArray[combArray[j]].ruleNo == rulepos))
<a name="l00383"></a>00383                     {
<a name="l00384"></a>00384                         <span class="comment">/* Copy the grammer before the 'F'. */</span>
<a name="l00385"></a>00385                         curr_len = (fposArray[combArray[j]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> - fposArray[combArray[j-1]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> - 1)*<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00386"></a>00386                         memcpy(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos] + curr_size, oldrule[rulepos] + fposArray[combArray[j-1]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> + 1, curr_len);
<a name="l00387"></a>00387                         curr_size += curr_len/<span class="keyword">sizeof</span>(ruleobj);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389                         <span class="comment">/* Insert the pertubation. */</span>
<a name="l00390"></a>00390                         <a class="code" href="agent_8c.html#7b90c3cf7f0961309c956c495b7c1017" title="Creates a random perturbation and stores it in the given ruleobj array.">random_perturbation</a>(pertarray);
<a name="l00391"></a>00391                         curr_len = 8*<span class="keyword">sizeof</span>(ruleobj);
<a name="l00392"></a>00392                         memcpy(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos] + curr_size, pertarray, curr_len);
<a name="l00393"></a>00393                         curr_size += curr_len/<span class="keyword">sizeof</span>(ruleobj);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395                         j++;
<a name="l00396"></a>00396                     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398                     <span class="comment">/* Concatenate the rest of the rule. */</span>
<a name="l00399"></a>00399                     curr_len = (oldrulelen[rulepos] - fposArray[combArray[j-1]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> - 1)*<span class="keyword">sizeof</span>(<a class="code" href="structruleobj.html" title="A single 'unit' in a rule.">ruleobj</a>);
<a name="l00400"></a>00400                     memcpy(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[rulepos] + curr_size, oldrule[rulepos] + fposArray[combArray[j-1]].<a class="code" href="structfpos__struct.html#c648b17986dd6fde012ef08bb4108f3b">pos</a> + 1, curr_len);
<a name="l00401"></a>00401                 }
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             <span class="comment">/* Create the L-System file. */</span>
<a name="l00405"></a>00405             asprintf(&amp;fname,  <span class="stringliteral">"pert_%d"</span>, combArray[0]);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407             strcpy(lsname, <span class="stringliteral">"pert"</span>);
<a name="l00408"></a>00408             <span class="keywordtype">char</span> *tempstr;
<a name="l00409"></a>00409             <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>; j++)
<a name="l00410"></a>00410             {
<a name="l00411"></a>00411                 asprintf(&amp;tempstr, <span class="stringliteral">"_%d"</span>, combArray[j]);
<a name="l00412"></a>00412                 strcat(lsname, tempstr);
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414             asprintf(&amp;tempstr, <span class="stringliteral">"_%d"</span>, i);
<a name="l00415"></a>00415             strcat(lsname, tempstr);
<a name="l00416"></a>00416             <a class="code" href="ls_8c.html#99bf866d5be91bf5dda75cc512f15480" title="Saves the specified L-System to file.">savetofile</a>(ls, fname, lsname, NULL);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418             <span class="comment">/* Find the fitness of the file. */</span>
<a name="l00419"></a>00419             ls-&gt;<a class="code" href="structlsystem.html#f1c5b179139be6e045ae3da298d64a2b" title="A boolean value indicating whether or not the fitness of this L-System has been calculated...">computed_f</a> = 0;
<a name="l00420"></a>00420             printf(<span class="stringliteral">"Computing fitness of L-System: %s\n"</span>, lsname); fflush(stdout);
<a name="l00421"></a>00421             <span class="comment">/* Find the average and standard deviations of the running times and number of bb nodes. */</span>
<a name="l00422"></a>00422             <a class="code" href="ls_8c.html#e387194071046d727dbdf72913716d3a" title="Computes the fitness of the specified L-System.">fitness</a>(ls);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424             <span class="comment">/* 'Fitness' has a differnt meaning now, because we now have a base case</span>
<a name="l00425"></a>00425 <span class="comment">               to compare to (i.e. the original fractal. */</span>
<a name="l00426"></a>00426             temp_fit1 = 0;
<a name="l00427"></a>00427             <span class="keywordflow">for</span> (j = 0; j &lt; NUM_ORDER_TEST; j++)
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 <span class="keywordflow">if</span> (ls-&gt;<a class="code" href="structlsystem.html#218ce793fabb7caf1e1d646c52c341d8" title="The size of each instance used for testing.">instancesize</a>[j] &gt; 100)
<a name="l00430"></a>00430                     temp_fit1 += j*((ls-&gt;<a class="code" href="structlsystem.html#a87a95a800f01c680a271412619649ec" title="The average time it takes for CONCORDE to solve instances created by this L-System...">runningtimes</a>[j] - 2*ls-&gt;<a class="code" href="structlsystem.html#2e8aadf5b7a62e0b3d7a0502b4832b59" title="The standard deviation of the set of running times.">sd</a>[j]) - origlowbound[j]);
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433             fprintf(fp, <span class="stringliteral">"%s\t\t\t"</span>, lsname);
<a name="l00434"></a>00434             <span class="keywordflow">for</span> (j = 0; j &lt; NUM_ORDER_TEST; j++)
<a name="l00435"></a>00435             {
<a name="l00436"></a>00436                 fprintf(fp, <span class="stringliteral">"[(%9.4f)(%9.4f)(%9.4f)]   "</span>, ls-&gt;<a class="code" href="structlsystem.html#a87a95a800f01c680a271412619649ec" title="The average time it takes for CONCORDE to solve instances created by this L-System...">runningtimes</a>[j], ls-&gt;<a class="code" href="structlsystem.html#2e8aadf5b7a62e0b3d7a0502b4832b59" title="The standard deviation of the set of running times.">sd</a>[j], ls-&gt;<a class="code" href="structlsystem.html#b3dd43d8588ba98ef510fa9e42051caf" title="The number of branch-and-bound nodes needed by CONCORDE to solve instances created...">avgbbnodes</a>[j]);
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438             fprintf(fp, <span class="stringliteral">"%9.4f\n"</span>, temp_fit1);
<a name="l00439"></a>00439             printf(<span class="stringliteral">"%s fitness: %0.4f\n"</span>, lsname, temp_fit1);
<a name="l00440"></a>00440             fflush(fp);
<a name="l00441"></a>00441             fflush(stdout);
<a name="l00442"></a>00442             temp_fit2 += temp_fit1;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444             <span class="comment">/* Clean up and reset the rules. */</span>
<a name="l00445"></a>00445             <span class="keywordflow">for</span> (j = 0; j &lt; ls-&gt;<a class="code" href="structlsystem.html#9dc456c2e8fcb8bf2e8b840f07529597" title="The number of rules in this L-System. It has to be at least two since the first one...">numrules</a>; j++)
<a name="l00446"></a>00446             {
<a name="l00447"></a>00447                 <span class="keywordflow">if</span> (oldrule[j] != NULL)
<a name="l00448"></a>00448                 {
<a name="l00449"></a>00449                     free(ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[j]);
<a name="l00450"></a>00450                     ls-&gt;<a class="code" href="structlsystem.html#4d421522b2bda8f4c5bc8f6d33f823b4" title="The set of rules.">rule</a>[j] = oldrule[j];
<a name="l00451"></a>00451                     ls-&gt;<a class="code" href="structlsystem.html#7ddefdbf59888f68ba09d42ae77e9132" title="The length of each rule (which is represented as a string) in this L-System.">rulelength</a>[j] = oldrulelen[j];
<a name="l00452"></a>00452                     oldrule[j] = NULL;
<a name="l00453"></a>00453                 }
<a name="l00454"></a>00454             }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456             <span class="comment">/* Make an indication as to how many 'very fit' L-Systems there are.</span>
<a name="l00457"></a>00457 <span class="comment">               The larger the fitness, the larger the count. If the count is large enough,</span>
<a name="l00458"></a>00458 <span class="comment">               we will assume there is a chance of finding more difficult/fit L-Systems</span>
<a name="l00459"></a>00459 <span class="comment">               and continue to sample random pertubations. */</span>
<a name="l00460"></a>00460             <span class="keywordflow">if</span> (temp_fit1 &gt;  50) count++;
<a name="l00461"></a>00461             <span class="keywordflow">if</span> (temp_fit1 &gt; 100) count++;
<a name="l00462"></a>00462             <span class="keywordflow">if</span> (temp_fit1 &gt; 200) count++;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464             <span class="comment">/* If after 20 samples, we don't have enough good instances, then it's</span>
<a name="l00465"></a>00465 <span class="comment">               time to move on to the next combination. */</span>
<a name="l00466"></a>00466             <span class="keywordflow">if</span> ((i == 20) &amp;&amp; (count &lt; 5))
<a name="l00467"></a>00467             {
<a name="l00468"></a>00468                 fprintf(fp, <span class="stringliteral">"*** not enough difficult instances ***\n"</span>);
<a name="l00469"></a>00469                 <span class="keywordflow">break</span>;
<a name="l00470"></a>00470             }
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472         fprintf(fp, <span class="stringliteral">"-----------------------------\nAverage\t\t\t%0.4f\n\n\n"</span>, temp_fit2/<a class="code" href="agent_8c.html#2d87b48d81b5fe21fdc05d03c6b29c14">NUM_RAND_INST</a>);  fflush(fp);
<a name="l00473"></a>00473     } <span class="keywordflow">while</span> (<a class="code" href="agent_8c.html#bbbdf5ef052c9228d902881d4c636f55" title="Changes the given int array to contain the next combination of numbers. No number...">nextCombination</a>(combArray, <a class="code" href="agent_8c.html#0ae3f473d868ad03e4ac42a5cc00e02e">NUM_F_CHANGED</a>, numFs, 0));
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     fclose(fp);
<a name="l00476"></a>00476     free(fposArray);
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 
<a name="l00488"></a><a class="code" href="agent_8c.html#3c04138a5bfe5d72780bb7e82a18e627">00488</a> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#3c04138a5bfe5d72780bb7e82a18e627" title="Starts the program.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="keywordtype">char</span> *filename;
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (argc != 2)
<a name="l00493"></a>00493     {
<a name="l00494"></a>00494         printf(<span class="stringliteral">"Usage: %s &lt;filename&gt;\n"</span>, argv[0]);
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496     <span class="keywordflow">else</span>
<a name="l00497"></a>00497         filename = argv[1];
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     FILE *fp = fopen(filename,<span class="stringliteral">"r"</span>);
<a name="l00500"></a>00500     <span class="keywordflow">if</span>(fp)
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502         fclose(fp);
<a name="l00503"></a>00503         <span class="comment">/* Create/Empty the file because ls.c only appends to the file. */</span>
<a name="l00504"></a>00504         fp = fopen(<span class="stringliteral">"temp.l"</span>, <span class="stringliteral">"w"</span>);
<a name="l00505"></a>00505         fclose(fp);
<a name="l00506"></a>00506         <span class="comment">/* Load any L-Systems the user specified. */</span>
<a name="l00507"></a>00507         <span class="keywordtype">int</span> i, n;
<a name="l00508"></a>00508         <a class="code" href="structlsystem.html" title="An L-System.">lsystem</a> **temp;
<a name="l00509"></a>00509         n = <a class="code" href="ls_8c.html#402ddf17410dc28aaa73d3c92e096ba4">readfile</a>(filename, &amp;temp, &amp;<a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>);
<a name="l00510"></a>00510         <a class="code" href="agent_8c.html#bc07ac30eb0da5dc83f6a0a4fa016cb2">names_size</a> = n;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         init_genrand(&amp;<a class="code" href="agent_8c.html#90b6273c1a16e912c14900d508377fcc">pert_rng</a>, time(NULL));
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00526"></a>00526         <a class="code" href="agent_8c.html#5376e996fa9d5f02bcf04e7c41af0162" title="Creates different perturbations of an L-System in the given lsystem array. and tries...">run</a>(temp, n);
<a name="l00527"></a>00527         printf(<span class="stringliteral">"\n"</span>);
<a name="l00528"></a>00528         printf(<span class="stringliteral">"deleting L-Systems ... Program completed successfully\n"</span>);
<a name="l00529"></a>00529         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00530"></a>00530         {
<a name="l00531"></a>00531             <a class="code" href="ls_8c.html#40e90454dbd91814ac3c979c05f1f576" title="Deletes the specified lsystem structure.">delete_ls</a>(temp[i]);
<a name="l00532"></a>00532             free(<a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>[i]);
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         free(<a class="code" href="agent_8c.html#26fc633cf551a2621e172633486c85ef">names</a>);
<a name="l00535"></a>00535         free(temp);
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri Feb 29 09:46:16 2008 for Memetic approach to slowing CONCORDE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
